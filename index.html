<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prompt & Agent Primer Library</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 40px;
            border-radius: 8px;
            position: relative;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .admin-link {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        .admin-link:hover {
            background: rgba(255,255,255,0.3);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .tab:hover {
            border-color: #667eea;
        }

        .tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .instructions {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .instructions h2 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .instructions ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        .section-header {
            background: white;
            padding: 20px 30px;
            border-radius: 8px 8px 0 0;
            border-bottom: 3px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header h2 {
            color: #667eea;
            font-size: 2em;
        }

        .add-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: background 0.3s;
        }

        .add-button:hover {
            background: #5568d3;
        }

        .search-box {
            background: white;
            padding: 20px 30px;
            border-radius: 0 0 8px 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .filter-buttons {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .filter-button {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-button:hover {
            border-color: #667eea;
        }

        .filter-button.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .item-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        .item-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .item-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .field-label {
            font-weight: 600;
            color: #555;
            margin-top: 12px;
            margin-bottom: 4px;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .field-content {
            color: #666;
            margin-bottom: 10px;
        }

        .prompt-text {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin-top: 8px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin-top: 8px;
        }

        .badge-approved {
            background: #4caf50;
            color: white;
        }

        .badge-experimental {
            background: #ff9800;
            color: white;
        }

        .approved-marker {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #4caf50;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .copy-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            transition: background 0.3s;
        }

        .copy-button:hover {
            background: #5568d3;
        }

        .tag {
            display: inline-block;
            background: #e0e7ff;
            color: #667eea;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            margin-right: 5px;
            margin-top: 5px;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 1.1em;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 8px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1em;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group small {
            display: block;
            color: #666;
            margin-top: 5px;
            font-size: 0.9em;
        }

        .list-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .list-input-container input {
            flex: 1;
        }

        .list-input-container button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .list-items {
            margin-top: 10px;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #f5f5f5;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .list-item button {
            background: #f44336;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        .modal-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .success-message {
            background: #4caf50;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }

        .success-message.active {
            display: block;
        }

        @media (max-width: 768px) {
            .items-grid {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 1.8em;
            }

            .admin-link {
                position: static;
                display: block;
                margin-top: 15px;
            }

            .modal-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ü§ñ AI Prompt & Agent Primer Library</h1>
            <p>Your curated collection of prompts and agent configurations</p>
            <a href="admin.html" class="admin-link">üîê Admin Login</a>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('browse')">üìö Browse Library</div>
            <div class="tab" onclick="switchTab('submit')">‚ûï Submit New Entry</div>
            <div class="tab" onclick="switchTab('instructions')">üìñ Instructions</div>
        </div>

        <!-- INSTRUCTIONS TAB -->
        <div class="tab-content active" id="instructions-tab">
            <div class="instructions">
                <h2>üìñ How to Use This Library</h2>
                <p><strong>Welcome!</strong> This library contains two collections:</p>
                <ul>
                    <li><strong>Prompt Library:</strong> Ready-to-use AI prompts for various tasks and use cases</li>
                    <li><strong>Agent Primer Library:</strong> Complete agent configurations with behavior guidelines and constraints</li>
                </ul>
                <p style="margin-top: 15px;"><strong>Browsing the Library:</strong></p>
                <ul>
                    <li>Use the search boxes to filter by keywords (searches across all fields)</li>
                    <li>Filter by "All", "Approved Only", or "Experimental Only"</li>
                    <li>Click the "Copy" button to copy prompt text or agent primers to your clipboard</li>
                    <li>Look for the green "APPROVED" badge on entries that have been verified by admins</li>
                </ul>
                <p style="margin-top: 15px;"><strong>Contributing to the Library:</strong></p>
                <ul>
                    <li>Click the "Submit New Entry" tab to add your own prompts or agent primers</li>
                    <li>All new submissions start as "Experimental" status</li>
                    <li>Admins will review and approve quality submissions</li>
                    <li>Approved entries get a green badge and are marked as trusted resources</li>
                </ul>
                <p style="margin-top: 15px;"><strong>For Admins:</strong></p>
                <ul>
                    <li>Click the "Admin Login" link in the top right to access the admin panel</li>
                    <li>Review pending submissions and approve or reject them</li>
                    <li>Manage all library entries</li>
                </ul>
            </div>
        </div>

        <!-- BROWSE TAB -->
        <div class="tab-content" id="browse-tab">
            <!-- PROMPT LIBRARY -->
            <div style="margin-bottom: 50px;">
                <div class="section-header">
                    <h2>üí¨ Prompt Library</h2>
                </div>
                <div class="search-box">
                    <input 
                        type="text" 
                        class="search-input" 
                        id="prompt-search" 
                        placeholder="Search prompts by purpose, audience, use case, or keywords..."
                    >
                    <div class="filter-buttons">
                        <button class="filter-button active" onclick="filterPrompts('all')">All</button>
                        <button class="filter-button" onclick="filterPrompts('approved')">‚úì Approved Only</button>
                        <button class="filter-button" onclick="filterPrompts('experimental')">‚ö° Experimental Only</button>
                    </div>
                </div>
                <div id="prompts-container" class="items-grid"></div>
            </div>

            <!-- AGENT PRIMER LIBRARY -->
            <div>
                <div class="section-header">
                    <h2>üéØ Agent Primer Library</h2>
                </div>
                <div class="search-box">
                    <input 
                        type="text" 
                        class="search-input" 
                        id="agent-search" 
                        placeholder="Search agent primers by name, purpose, intended users, or keywords..."
                    >
                    <div class="filter-buttons">
                        <button class="filter-button active" onclick="filterAgents('all')">All</button>
                        <button class="filter-button" onclick="filterAgents('approved')">‚úì Approved Only</button>
                        <button class="filter-button" onclick="filterAgents('experimental')">‚ö° Experimental Only</button>
                    </div>
                </div>
                <div id="agents-container" class="items-grid"></div>
            </div>
        </div>

        <!-- SUBMIT TAB -->
        <div class="tab-content" id="submit-tab">
            <div class="instructions">
                <h2>‚ûï Submit a New Entry</h2>
                <p>Choose what type of entry you'd like to submit:</p>
            </div>

            <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 30px;">
                <button class="add-button" onclick="openPromptModal()" style="flex: 1; min-width: 250px; padding: 30px; font-size: 1.1em;">
                    üí¨ Submit a Prompt
                </button>
                <button class="add-button" onclick="openAgentModal()" style="flex: 1; min-width: 250px; padding: 30px; font-size: 1.1em;">
                    üéØ Submit an Agent Primer
                </button>
            </div>

            <div class="instructions">
                <h3>üìù Submission Guidelines</h3>
                <ul>
                    <li>All submissions start with "Experimental" status</li>
                    <li>Admins will review and approve quality entries</li>
                    <li>Be clear and specific in your descriptions</li>
                    <li>Include practical use cases and examples</li>
                    <li>For agent primers, clearly define allowed tasks and exclusions</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- PROMPT SUBMISSION MODAL -->
    <div id="prompt-modal" class="modal">
        <div class="modal-content">
            <div id="prompt-success" class="success-message">‚úì Prompt submitted successfully! It will be reviewed by admins.</div>
            <h2>Submit a New Prompt</h2>
            <form id="prompt-form">
                <div class="form-group">
                    <label>Purpose *</label>
                    <input type="text" id="prompt-purpose" required>
                    <small>What is this prompt designed to accomplish?</small>
                </div>

                <div class="form-group">
                    <label>Audience *</label>
                    <input type="text" id="prompt-audience" required>
                    <small>Who should use this prompt? (e.g., "Software developers", "Marketing teams")</small>
                </div>

                <div class="form-group">
                    <label>Prompt Text *</label>
                    <textarea id="prompt-text" required></textarea>
                    <small>The actual prompt text users will copy and use</small>
                </div>

                <div class="form-group">
                    <label>Use Cases *</label>
                    <div class="list-input-container">
                        <input type="text" id="prompt-usecase-input" placeholder="Enter a use case">
                        <button type="button" onclick="addPromptUseCase()">Add</button>
                    </div>
                    <div id="prompt-usecases" class="list-items"></div>
                    <small>Add one or more specific use cases for this prompt</small>
                </div>

                <div class="form-group">
                    <label>Alternate Variables</label>
                    <textarea id="prompt-variables"></textarea>
                    <small>Optional: Describe how this prompt can be customized or modified</small>
                </div>

                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="prompt-notes"></textarea>
                    <small>Optional: Any additional tips, warnings, or context</small>
                </div>

                <div class="modal-buttons">
                    <button type="button" class="btn-secondary" onclick="closePromptModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Submit Prompt</button>
                </div>
            </form>
        </div>
    </div>

    <!-- AGENT SUBMISSION MODAL -->
    <div id="agent-modal" class="modal">
        <div class="modal-content">
            <div id="agent-success" class="success-message">‚úì Agent primer submitted successfully! It will be reviewed by admins.</div>
            <h2>Submit a New Agent Primer</h2>
            <form id="agent-form">
                <div class="form-group">
                    <label>Agent Name *</label>
                    <input type="text" id="agent-name" required>
                    <small>Give your agent a descriptive name</small>
                </div>

                <div class="form-group">
                    <label>Purpose *</label>
                    <textarea id="agent-purpose" required></textarea>
                    <small>What is this agent designed to do?</small>
                </div>

                <div class="form-group">
                    <label>Intended Users *</label>
                    <input type="text" id="agent-users" required>
                    <small>Who should use this agent? (e.g., "Data analysts, researchers")</small>
                </div>

                <div class="form-group">
                    <label>Allowed Tasks *</label>
                    <div class="list-input-container">
                        <input type="text" id="agent-task-input" placeholder="Enter an allowed task">
                        <button type="button" onclick="addAgentTask()">Add</button>
                    </div>
                    <div id="agent-tasks" class="list-items"></div>
                    <small>List specific tasks this agent is allowed to perform</small>
                </div>

                <div class="form-group">
                    <label>Explicit Exclusions *</label>
                    <div class="list-input-container">
                        <input type="text" id="agent-exclusion-input" placeholder="Enter an exclusion">
                        <button type="button" onclick="addAgentExclusion()">Add</button>
                    </div>
                    <div id="agent-exclusions" class="list-items"></div>
                    <small>List what this agent should NOT do</small>
                </div>

                <div class="form-group">
                    <label>Tone & Behavior *</label>
                    <textarea id="agent-tone" required></textarea>
                    <small>Describe how this agent should communicate and behave</small>
                </div>

                <div class="form-group">
                    <label>Data Handling Instructions</label>
                    <textarea id="agent-data"></textarea>
                    <small>Optional: Any special instructions for handling sensitive data</small>
                </div>

                <div class="modal-buttons">
                    <button type="button" class="btn-secondary" onclick="closeAgentModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Submit Agent Primer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        // REPLACE THESE WITH YOUR FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ============================================
        // STATE MANAGEMENT
        // ============================================
        let allPrompts = [];
        let allAgents = [];
        let currentPromptFilter = 'all';
        let currentAgentFilter = 'all';
        let promptUseCases = [];
        let agentTasks = [];
        let agentExclusions = [];

        // ============================================
        // LOAD DATA FROM FIREBASE
        // ============================================
        function loadPrompts() {
            db.collection('prompts').onSnapshot((snapshot) => {
                allPrompts = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                renderPrompts();
            });
        }

        function loadAgents() {
            db.collection('agents').onSnapshot((snapshot) => {
                allAgents = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                renderAgents();
            });
        }

        // ============================================
        // RENDERING FUNCTIONS
        // ============================================
        function renderPrompts() {
            const container = document.getElementById('prompts-container');
            const searchTerm = document.getElementById('prompt-search').value.toLowerCase();
            
            let filtered = allPrompts.filter(prompt => {
                // Filter by status
                if (currentPromptFilter === 'approved' && prompt.status !== 'approved') return false;
                if (currentPromptFilter === 'experimental' && prompt.status !== 'experimental') return false;
                
                // Filter by search term
                if (searchTerm) {
                    const searchableText = `${prompt.purpose} ${prompt.audience} ${prompt.promptText} ${prompt.useCases.join(' ')} ${prompt.alternateVariables || ''} ${prompt.notes || ''}`.toLowerCase();
                    if (!searchableText.includes(searchTerm)) return false;
                }
                
                return true;
            });

            if (filtered.length === 0) {
                container.innerHTML = '<div class="no-results">No prompts found matching your search.</div>';
                return;
            }

            container.innerHTML = filtered.map(prompt => `
                <div class="item-card">
                    ${prompt.status === 'approved' ? '<div class="approved-marker">‚úì APPROVED</div>' : ''}
                    
                    <h3>${prompt.purpose}</h3>
                    <span class="badge ${prompt.status === 'approved' ? 'badge-approved' : 'badge-experimental'}">
                        ${prompt.status.toUpperCase()}
                    </span>
                    
                    <div class="field-label">Audience</div>
                    <div class="field-content">${prompt.audience}</div>
                    
                    <div class="field-label">Use Cases</div>
                    <div class="field-content">
                        ${prompt.useCases.map(uc => `<span class="tag">${uc}</span>`).join('')}
                    </div>
                    
                    <div class="field-label">Prompt Text</div>
                    <div class="prompt-text">${prompt.promptText}</div>
                    
                    ${prompt.alternateVariables ? `
                        <div class="field-label">Alternate Variables</div>
                        <div class="field-content">${prompt.alternateVariables}</div>
                    ` : ''}
                    
                    ${prompt.notes ? `
                        <div class="field-label">Notes</div>
                        <div class="field-content">${prompt.notes}</div>
                    ` : ''}
                    
                    <button class="copy-button" onclick='copyPromptText(\`${prompt.promptText.replace(/`/g, '\\`')}\`)'>
                        üìã Copy Prompt
                    </button>
                </div>
            `).join('');
        }

        function renderAgents() {
            const container = document.getElementById('agents-container');
            const searchTerm = document.getElementById('agent-search').value.toLowerCase();
            
            let filtered = allAgents.filter(agent => {
                // Filter by status
                if (currentAgentFilter === 'approved' && agent.status !== 'approved') return false;
                if (currentAgentFilter === 'experimental' && agent.status !== 'experimental') return false;
                
                // Filter by search term
                if (searchTerm) {
                    const searchableText = `${agent.agentName} ${agent.purpose} ${agent.intendedUsers} ${agent.allowedTasks.join(' ')} ${agent.explicitExclusions.join(' ')} ${agent.toneBehavior} ${agent.dataHandling || ''}`.toLowerCase();
                    if (!searchableText.includes(searchTerm)) return false;
                }
                
                return true;
            });

            if (filtered.length === 0) {
                container.innerHTML = '<div class="no-results">No agent primers found matching your search.</div>';
                return;
            }

            container.innerHTML = filtered.map(agent => `
                <div class="item-card">
                    ${agent.status === 'approved' ? '<div class="approved-marker">‚úì APPROVED</div>' : ''}
                    
                    <h3>${agent.agentName}</h3>
                    <span class="badge ${agent.status === 'approved' ? 'badge-approved' : 'badge-experimental'}">
                        ${agent.status.toUpperCase()}
                    </span>
                    
                    <div class="field-label">Purpose</div>
                    <div class="field-content">${agent.purpose}</div>
                    
                    <div class="field-label">Intended Users</div>
                    <div class="field-content">${agent.intendedUsers}</div>
                    
                    <div class="field-label">Allowed Tasks</div>
                    <div class="field-content">
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            ${agent.allowedTasks.map(task => `<li>${task}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="field-label">Explicit Exclusions</div>
                    <div class="field-content">
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            ${agent.explicitExclusions.map(excl => `<li>${excl}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="field-label">Tone & Behavior</div>
                    <div class="field-content">${agent.toneBehavior}</div>
                    
                    ${agent.dataHandling ? `
                        <div class="field-label">Data Handling</div>
                        <div class="field-content">${agent.dataHandling}</div>
                    ` : ''}
                    
                    <button class="copy-button" onclick="copyAgentPrimer('${agent.id}')">
                        üìã Copy Agent Primer
                    </button>
                </div>
            `).join('');
        }

        // ============================================
        // FILTER FUNCTIONS
        // ============================================
        function filterPrompts(filter) {
            currentPromptFilter = filter;
            document.querySelectorAll('.filter-buttons')[0].querySelectorAll('.filter-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            renderPrompts();
        }

        function filterAgents(filter) {
            currentAgentFilter = filter;
            document.querySelectorAll('.filter-buttons')[1].querySelectorAll('.filter-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            renderAgents();
        }

        // ============================================
        // COPY FUNCTIONS
        // ============================================
        function copyPromptText(text) {
            navigator.clipboard.writeText(text).then(() => {
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = '‚úì Copied!';
                button.style.background = '#4caf50';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                }, 2000);
            });
        }

        function copyAgentPrimer(agentId) {
            const agent = allAgents.find(a => a.id === agentId);
            const primerText = `
AGENT NAME: ${agent.agentName}

PURPOSE: ${agent.purpose}

INTENDED USERS: ${agent.intendedUsers}

ALLOWED TASKS:
${agent.allowedTasks.map(task => `- ${task}`).join('\n')}

EXPLICIT EXCLUSIONS:
${agent.explicitExclusions.map(excl => `- ${excl}`).join('\n')}

TONE & BEHAVIOR: ${agent.toneBehavior}

${agent.dataHandling ? `DATA HANDLING: ${agent.dataHandling}` : ''}

STATUS: ${agent.status.toUpperCase()}
            `.trim();

            navigator.clipboard.writeText(primerText).then(() => {
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = '‚úì Copied!';
                button.style.background = '#4caf50';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                }, 2000);
            });
        }

        // ============================================
        // TAB SWITCHING
        // ============================================
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // ============================================
        // MODAL FUNCTIONS
        // ============================================
        function openPromptModal() {
            document.getElementById('prompt-modal').classList.add('active');
            promptUseCases = [];
            document.getElementById('prompt-form').reset();
            document.getElementById('prompt-usecases').innerHTML = '';
            document.getElementById('prompt-success').classList.remove('active');
        }

        function closePromptModal() {
            document.getElementById('prompt-modal').classList.remove('active');
        }

        function openAgentModal() {
            document.getElementById('agent-modal').classList.add('active');
            agentTasks = [];
            agentExclusions = [];
            document.getElementById('agent-form').reset();
            document.getElementById('agent-tasks').innerHTML = '';
            document.getElementById('agent-exclusions').innerHTML = '';
            document.getElementById('agent-success').classList.remove('active');
        }

        function closeAgentModal() {
            document.getElementById('agent-modal').classList.remove('active');
        }

        // ============================================
        // LIST MANAGEMENT
        // ============================================
        function addPromptUseCase() {
            const input = document.getElementById('prompt-usecase-input');
            const value = input.value.trim();
            if (value) {
                promptUseCases.push(value);
                renderPromptUseCases();
                input.value = '';
            }
        }

        function removePromptUseCase(index) {
            promptUseCases.splice(index, 1);
            renderPromptUseCases();
        }

        function renderPromptUseCases() {
            const container = document.getElementById('prompt-usecases');
            container.innerHTML = promptUseCases.map((uc, index) => `
                <div class="list-item">
                    <span>${uc}</span>
                    <button onclick="removePromptUseCase(${index})">Remove</button>
                </div>
            `).join('');
        }

        function addAgentTask() {
            const input = document.getElementById('agent-task-input');
            const value = input.value.trim();
            if (value) {
                agentTasks.push(value);
                renderAgentTasks();
                input.value = '';
            }
        }

        function removeAgentTask(index) {
            agentTasks.splice(index, 1);
            renderAgentTasks();
        }

        function renderAgentTasks() {
            const container = document.getElementById('agent-tasks');
            container.innerHTML = agentTasks.map((task, index) => `
                <div class="list-item">
                    <span>${task}</span>
                    <button onclick="removeAgentTask(${index})">Remove</button>
                </div>
            `).join('');
        }

        function addAgentExclusion() {
            const input = document.getElementById('agent-exclusion-input');
            const value = input.value.trim();
            if (value) {
                agentExclusions.push(value);
                renderAgentExclusions();
                input.value = '';
            }
        }

        function removeAgentExclusion(index) {
            agentExclusions.splice(index, 1);
            renderAgentExclusions();
        }

        function renderAgentExclusions() {
            const container = document.getElementById('agent-exclusions');
            container.innerHTML = agentExclusions.map((excl, index) => `
                <div class="list-item">
                    <span>${excl}</span>
                    <button onclick="removeAgentExclusion(${index})">Remove</button>
                </div>
            `).join('');
        }

        // ============================================
        // FORM SUBMISSION
        // ============================================
        document.getElementById('prompt-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (promptUseCases.length === 0) {
                alert('Please add at least one use case');
                return;
            }

            const promptData = {
                purpose: document.getElementById('prompt-purpose').value,
                audience: document.getElementById('prompt-audience').value,
                promptText: document.getElementById('prompt-text').value,
                useCases: promptUseCases,
                alternateVariables: document.getElementById('prompt-variables').value || null,
                notes: document.getElementById('prompt-notes').value || null,
                status: 'experimental',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                await db.collection('prompts').add(promptData);
                document.getElementById('prompt-success').classList.add('active');
                document.getElementById('prompt-form').reset();
                promptUseCases = [];
                renderPromptUseCases();
                
                setTimeout(() => {
                    closePromptModal();
                }, 2000);
            } catch (error) {
                console.error('Error submitting prompt:', error);
                alert('Error submitting prompt. Please try again.');
            }
        });

        document.getElementById('agent-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (agentTasks.length === 0) {
                alert('Please add at least one allowed task');
                return;
            }
            
            if (agentExclusions.length === 0) {
                alert('Please add at least one explicit exclusion');
                return;
            }

            const agentData = {
                agentName: document.getElementById('agent-name').value,
                purpose: document.getElementById('agent-purpose').value,
                intendedUsers: document.getElementById('agent-users').value,
                allowedTasks: agentTasks,
                explicitExclusions: agentExclusions,
                toneBehavior: document.getElementById('agent-tone').value,
                dataHandling: document.getElementById('agent-data').value || null,
                status: 'experimental',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                await db.collection('agents').add(agentData);
                document.getElementById('agent-success').classList.add('active');
                document.getElementById('agent-form').reset();
                agentTasks = [];
                agentExclusions = [];
                renderAgentTasks();
                renderAgentExclusions();
                
                setTimeout(() => {
                    closeAgentModal();
                }, 2000);
            } catch (error) {
                console.error('Error submitting agent:', error);
                alert('Error submitting agent primer. Please try again.');
            }
        });

        // ============================================
        // SEARCH EVENT LISTENERS
        // ============================================
        document.getElementById('prompt-search').addEventListener('input', renderPrompts);
        document.getElementById('agent-search').addEventListener('input', renderAgents);

        // ============================================
        // INITIALIZE
        // ============================================
        loadPrompts();
        loadAgents();

        // Allow Enter key to submit list items
        document.getElementById('prompt-usecase-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                addPromptUseCase();
            }
        });
        
        document.getElementById('agent-task-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                addAgentTask();
            }
        });
        
        document.getElementById('agent-exclusion-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                addAgentExclusion();
            }
        });
    </script>
</body>
</html>
